apiVersion: skaffold/v2beta28
kind: Config
metadata:
  name: poc-distributed-scheduling
build:
  artifacts:
  - image: opennms/distributed-scheduling-poc
    context: .
    custom:
      buildCommand: ./skaffold-build.sh
      dependencies:
        paths: ["."]
        ignore: [
          "**/target/**", 
          "**/dependency-reduced-pom.xml" # generated by maven-shade-plugin, these cause file watching to break when running `skaffold debug`
        ]
    sync:
      auto: true
  - image: opennms/ds-poc-test-driver
    context: .
    jib:
      project: test-driver
    sync:
      auto: true

portForward:
  - resourceType: service
    resourceName: poc-distributed-scheduling
    port: 8181
    localPort: 8001
  - resourceType: service
    resourceName: poc-distributed-scheduling
    port: 8101
    localPort: 8101
  - resourceType: service
    resourceName: poc-test-driver
    port: 8080
    localPort: 8080

deploy:
  kubectl:
    manifests:
    - ./manifests/poc-distributed-scheduling.yaml
